/*
 * mescroll -- 精致的下拉刷新和上拉加载js框架  ( a great JS framework for pull-refresh and pull-up-loading )
 * version 1.2.5
 * 2017-11-25
 * 
 * 您如果在vue,angular等环境中,因作用域的问题未能正常引入或初始化Mescroll对象,则可引用mescroll.m.js;
 * mescroll.m.js去掉了mescroll.min.js套的一层模块规范的代码
 * 因为没有闭包限制作用域,所以能解决某些情况下引用mescroll.min.js报'Mescroll' undefined的问题
 * 具体请参考: https://github.com/mescroll/mescroll/issues/56
 */
function MeScroll(a,d){var g=this;g.isScrollBody=(!a||a=="body");g.scrollDom=g.isScrollBody?document.body:document.getElementById(a);if(!g.scrollDom){console.error('找不到id为"'+a+'"的DOM元素: document.getElementById("'+a+'")==null');return}g.options=d||{};var e=g.options.down&&g.options.down.callback;var c=navigator.userAgent;var b=!!c.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);var h=typeof window.orientation=="undefined";var f=c.indexOf("Android")>-1||c.indexOf("Adr")>-1;g.os={ios:b,pc:h,android:f};if(g.os.ios&&!g.isScrollBody){g.bounceDom=g.scrollDom.getElementsByClassName("mescroll-bounce")[0];if(g.bounceDom){g.isBounceDisable=true;g.bounceDom.style.minHeight=(g.getClientHeight()+5)+"px"}}g.isDownScrolling=false;g.isUpScrolling=false;g.initDownScroll();g.initUpScroll();setTimeout(function(){if(g.optDown.auto){if(g.optDown.autoShowLoading){g.triggerDownScroll()}else{g.optDown.callback&&g.optDown.callback(g)}}if(g.optDown.auto&&g.optUp.auto&&!e){}else{g.optUp.auto&&g.triggerUpScroll()}},30)}MeScroll.prototype.extendDownScroll=function(a){MeScroll.extend(a,{use:true,auto:true,autoShowLoading:false,isLock:false,isBoth:false,offset:80,outOffsetRate:0.2,bottomOffset:20,minAngle:45,hardwareClass:"mescroll-hardware",warpId:null,warpClass:"mescroll-downwarp",resetClass:"mescroll-downwarp-reset",htmlContent:'<p class="downwarp-progress"></p><p class="downwarp-tip">下拉刷新 </p>',inited:function(c,b){c.downTipDom=b.getElementsByClassName("downwarp-tip")[0];c.downProgressDom=b.getElementsByClassName("downwarp-progress")[0]},inOffset:function(b){if(b.downTipDom){b.downTipDom.innerHTML="下拉刷新"}if(b.downProgressDom){b.downProgressDom.classList.remove("mescroll-rotate")}},outOffset:function(b){if(b.downTipDom){b.downTipDom.innerHTML="释放更新"}},onMoving:function(c,e,b){if(c.downProgressDom){var d=360*e;c.downProgressDom.style.webkitTransform="rotate("+d+"deg)";c.downProgressDom.style.transform="rotate("+d+"deg)"}},beforeLoading:function(c,b){return false},showLoading:function(b){if(b.downTipDom){b.downTipDom.innerHTML="加载中 ..."}if(b.downProgressDom){b.downProgressDom.classList.add("mescroll-rotate")}},callback:function(b){b.resetUpScroll()}})};MeScroll.prototype.extendUpScroll=function(a){var b=this.os.pc;MeScroll.extend(a,{use:true,auto:false,isLock:false,isBoth:false,callback:null,page:{num:0,size:10,time:null},noMoreSize:5,offset:100,toTop:{src:null,offset:1000,warpClass:"mescroll-totop",showClass:"mescroll-fade-in",hideClass:"mescroll-fade-out",duration:300},loadFull:{use:false,delay:500},empty:{warpId:null,icon:null,tip:"暂无相关数据~",btntext:"",btnClick:null},clearId:null,clearEmptyId:null,hardwareClass:"mescroll-hardware",warpId:null,warpClass:"mescroll-upwarp",htmlLoading:'<p class="upwarp-progress mescroll-rotate"></p><p class="upwarp-tip">加载中..</p>',htmlNodata:'<p class="upwarp-nodata">-- END --</p>',inited:function(c,d){},showLoading:function(c,d){d.innerHTML=c.optUp.htmlLoading},showNoMore:function(c,d){d.innerHTML=c.optUp.htmlNodata},onScroll:null,scrollbar:{use:b,barClass:"mescroll-bar"}})};MeScroll.extend=function(b,a){if(!b){return a}for(key in a){if(b[key]==null){b[key]=a[key]}else{if(typeof b[key]=="object"){MeScroll.extend(b[key],a[key])}}}return b};MeScroll.prototype.initDownScroll=function(){var a=this;a.optDown=a.options.down||{};if(a.optDown.use==false){return}a.extendDownScroll(a.optDown);a.downwarp=document.createElement("div");a.downwarp.className=a.optDown.warpClass;a.downwarp.innerHTML='<div class="downwarp-content">'+a.optDown.htmlContent+"</div>";a.downparent=a.optDown.warpId?document.getElementById(a.optDown.warpId):a.scrollDom;if(a.optDown.warpId){a.downparent.appendChild(a.downwarp)}else{a.downparent.insertBefore(a.downwarp,a.scrollDom.firstChild)}a.touchstartEvent=function(f){if(a.isScrollTo){f.preventDefault()}a.startTop=a.getScrollTop();if(a.isBounceDisable){a.bounceDom.style.minHeight=(a.getClientHeight()+5)+"px";if(a.startTop<=0){a.setScrollTop(1);a.startTop=1}else{if(a.optUp.isLock){var d=a.getScrollHeight();var b=a.getClientHeight();var c=d-b-a.startTop;if(c<=0){a.startTop=d-b-1;a.setScrollTop(a.startTop)}}}}a.endTouchmove=false;a.maxTouchmoveY=a.getBodyHeight()-a.optDown.bottomOffset;if(!a.os.ios){a.startY=f.touches?f.touches[0].pageY:f.clientY}};a.scrollDom.addEventListener("touchstart",a.touchstartEvent);a.scrollDom.addEventListener("mousedown",a.touchstartEvent);a.touchmoveEvent=function(i){if(a.isBounceDisable&&a.isDownScrolling){i.preventDefault();return}var d=a.getScrollTop();if(a.startTop!=null&&d<=0&&!a.isDownScrolling&&(!a.isUpScrolling||(a.isUpScrolling&&a.optUp.isBoth))&&!a.optDown.isLock&&!a.endTouchmove){if(!a.os.ios&&a.startTop>0){return}var c=i.touches?i.touches[0].pageX:i.clientX;var b=i.touches?i.touches[0].pageY:i.clientY;if(!a.preX){a.preX=c}if(!a.preY){a.preY=b}var l=Math.abs(a.preX-c);var k=Math.abs(a.preY-b);var j=Math.sqrt(l*l+k*k);var m=b-a.preY;a.preX=c;a.preY=b;if(j!=0){var g=Math.asin(k/j)/Math.PI*180;if(g<a.optDown.minAngle){return}}if(!a.startY&&a.os.ios){a.startY=b}var f=b-a.startY-d;if(f>0){i.preventDefault();if(a.maxTouchmoveY>0&&b>=a.maxTouchmoveY){a.endTouchmove=true;a.touchendEvent();return}if(!a.downHight){a.downHight=0}if(a.downHight<a.optDown.offset){if(a.movetype!=1){a.movetype=1;a.optDown.inOffset(a);a.downwarp.classList.remove(a.optDown.resetClass);a.scrollDom.classList.add(a.optDown.hardwareClass);a.scrollDom.style.webkitOverflowScrolling="auto";a.isMoveDown=true}a.downHight+=m}else{if(a.movetype!=2){a.movetype=2;a.optDown.outOffset(a);a.downwarp.classList.remove(a.optDown.resetClass);a.scrollDom.classList.add(a.optDown.hardwareClass);a.scrollDom.style.webkitOverflowScrolling="auto";a.isMoveDown=true}if(m>0){a.downHight+=m*a.optDown.outOffsetRate}else{a.downHight+=m}}a.downwarp.style.height=a.downHight+"px";var h=a.downHight/a.optDown.offset;a.optDown.onMoving(a,h,a.downHight)}}};a.scrollDom.addEventListener("touchmove",a.touchmoveEvent);a.scrollDom.addEventListener("mousemove",a.touchmoveEvent);a.touchendEvent=function(){if(a.isMoveDown){if(a.downHight>=a.optDown.offset){a.triggerDownScroll()}else{a.downwarp.classList.add(a.optDown.resetClass);a.downHight=0;a.downwarp.style.height=0}a.scrollDom.style.webkitOverflowScrolling="touch";a.scrollDom.classList.remove(a.optDown.hardwareClass);a.movetype=0;a.isMoveDown=false}a.startY=0;a.preX=0;a.preY=0;a.startTop=null};a.scrollDom.addEventListener("touchend",a.touchendEvent);a.scrollDom.addEventListener("mouseup",a.touchendEvent);a.scrollDom.addEventListener("mouseleave",a.touchendEvent);setTimeout(function(){a.optDown.inited(a,a.downwarp)},0)};MeScroll.prototype.triggerDownScroll=function(){if(!this.optDown.beforeLoading(this,this.downwarp)){this.showDownScroll();this.optDown.callback&&this.optDown.callback(this)}};MeScroll.prototype.showDownScroll=function(){this.isDownScrolling=true;this.optDown.showLoading(this);this.downHight=this.optDown.offset;this.downwarp.classList.add(this.optDown.resetClass);this.downwarp.style.height=this.optDown.offset+"px"};MeScroll.prototype.endDownScroll=function(){this.downHight=0;this.downwarp.style.height=0;this.isDownScrolling=false;if(this.downProgressDom){this.downProgressDom.classList.remove("mescroll-rotate")}};MeScroll.prototype.lockDownScroll=function(a){if(a==null){a=true}this.optDown.isLock=a};MeScroll.prototype.initUpScroll=function(){var b=this;b.optUp=b.options.up||{use:false};b.extendUpScroll(b.optUp);if(b.optUp.scrollbar.use){b.scrollDom.classList.add(b.optUp.scrollbar.barClass)}if(b.isBounceDisable){b.setBounceDisable(true)}if(b.optUp.use==false){return}b.upwarp=document.createElement("div");b.upwarp.className=b.optUp.warpClass;var a;if(b.optUp.warpId){a=document.getElementById(b.optUp.warpId)}else{if(b.isBounceDisable){if(b.bounceDom){a=b.bounceDom}}}b.upparent=a||b.scrollDom;b.upparent.appendChild(b.upwarp);b.preScrollY=0;b.scrollEvent=function(){var e=b.getScrollTop();var d=e-b.preScrollY>0;b.preScrollY=e;if(!b.isUpScrolling&&(!b.isDownScrolling||(b.isDownScrolling&&b.optDown.isBoth))){if(!b.optUp.isLock){var c=b.getScrollHeight()-b.getClientHeight()-e;if(c<=b.optUp.offset&&d){b.triggerUpScroll()}}if(b.optUp.toTop.src){if(e>=b.optUp.toTop.offset){b.showTopBtn()}else{b.hideTopBtn()}}}b.optUp.onScroll&&b.optUp.onScroll(b,e,d)};if(b.isScrollBody){window.addEventListener("scroll",b.scrollEvent)}else{b.scrollDom.addEventListener("scroll",b.scrollEvent)}setTimeout(function(){b.optUp.inited(b,b.upwarp)},0)};MeScroll.prototype.setBounceDisable=function(a){if(this.isScrollBody||!this.os.ios){return}if(a){this.isBounceDisable=true;window.addEventListener("touchmove",this.bounceTouchmove,false)}else{this.isBounceDisable=false;window.removeEventListener("touchmove",this.bounceTouchmove,false)}};MeScroll.prototype.bounceTouchmove=function(g){var i=this;var c=g.target;var d=true;while(c!==document.body&&c!==document){var m=c.classList;if(m){if(m.contains("mescroll")||m.contains("mescroll-touch")){d=false;break}else{if(m.contains("mescroll-touch-x")||m.contains("mescroll-touch-y")){var b=g.touches?g.touches[0].pageX:g.clientX;var a=g.touches?g.touches[0].pageY:g.clientY;if(!i.preWinX){i.preWinX=b}if(!i.preWinY){i.preWinY=a}var k=Math.abs(i.preWinX-b);var j=Math.abs(i.preWinY-a);var h=Math.sqrt(k*k+j*j);var l=a-i.preWinY;i.preWinX=b;i.preWinY=a;if(h!=0){var f=Math.asin(j/h)/Math.PI*180;if((f<=45&&m.contains("mescroll-touch-x"))||(f>45&&m.contains("mescroll-touch-y"))){d=false;break}}}}}c=c.parentNode}d&&g.preventDefault()};MeScroll.prototype.triggerUpScroll=function(){this.showUpScroll();this.optUp.page.num++;this.optUp.callback&&this.optUp.callback(this.optUp.page,this)};MeScroll.prototype.showUpScroll=function(){this.isUpScrolling=true;this.upwarp.classList.add(this.optUp.hardwareClass);this.upwarp.style.visibility="visible";this.optUp.showLoading(this,this.upwarp)};MeScroll.prototype.showNoMore=function(){this.upwarp.style.visibility="visible";this.optUp.isLock=true;this.optUp.showNoMore(this,this.upwarp)};MeScroll.prototype.hideUpScroll=function(){this.upwarp.style.visibility="hidden";this.upwarp.classList.remove(this.optUp.hardwareClass);var a=this.upwarp.getElementsByClassName("upwarp-progress")[0];if(a){a.classList.remove("mescroll-rotate")}};MeScroll.prototype.endUpScroll=function(a){if(a!=null){if(a){this.showNoMore()}else{this.hideUpScroll()}}this.isUpScrolling=false};MeScroll.prototype.resetUpScroll=function(b){if(this.optUp&&this.optUp.use){var a=this.optUp.page;this.prePageNum=a.num;this.prePageTime=a.time;a.num=1;a.time=null;if(!this.isDownScrolling&&b!=false){if(b==null){this.removeEmpty();this.clearDataList();this.showUpScroll()}else{this.showDownScroll()}}this.optUp.callback&&this.optUp.callback(a,this)}};MeScroll.prototype.setPageNum=function(a){this.optUp.page.num=a-1};MeScroll.prototype.setPageSize=function(a){this.optUp.page.size=a};MeScroll.prototype.clearDataList=function(){var b=this.optUp.clearId||this.optUp.clearEmptyId;if(b){var a=document.getElementById(b);if(a){a.innerHTML=""}}};MeScroll.prototype.endByPage=function(b,d,c){var a;if(this.optUp.use&&d!=null){a=this.optUp.page.num<d}this.endSuccess(b,a,c)};MeScroll.prototype.endBySize=function(c,b,d){var a;if(this.optUp.use&&b!=null){var e=(this.optUp.page.num-1)*this.optUp.page.size+c;a=e<b}this.endSuccess(c,a,d)};MeScroll.prototype.endSuccess=function(c,a,e){if(this.isDownScrolling){this.endDownScroll()}if(this.optUp.use){var f=this.optUp.page.num;var b=this.optUp.page.size;if(f==1){this.clearDataList()}var d;if(c!=null){if(c<b||a==false){this.optUp.isLock=true;if(c==0&&f==1){d=false;this.showEmpty()}else{var g=(f-1)*b+c;if(g<this.optUp.noMoreSize){d=false}else{d=true}this.removeEmpty()}}else{d=false;this.optUp.isLock=false;this.removeEmpty()}}if(f==1&&e){this.optUp.page.time=e}this.endUpScroll(d);this.loadFull()}};MeScroll.prototype.endErr=function(){if(this.isDownScrolling){var a=this.optUp.page;if(a&&this.prePageNum){a.num=this.prePageNum;a.time=this.prePageTime}this.endDownScroll()}if(this.isUpScrolling){this.optUp.page.num--;this.endUpScroll(false)}};MeScroll.prototype.loadFull=function(){var a=this;if(a.optUp.loadFull.use&&!a.optUp.isLock&&a.getScrollHeight()<=a.getClientHeight()){setTimeout(function(){if(a.getScrollHeight()<=a.getClientHeight()){a.triggerUpScroll()}},a.optUp.loadFull.delay)}};MeScroll.prototype.lockUpScroll=function(a){if(a==null){a=true}this.optUp.isLock=a};MeScroll.prototype.showEmpty=function(){var b=this;var c=b.optUp.empty;var a=c.warpId||b.optUp.clearEmptyId;if(a==null){return}var f=document.getElementById(a);if(f){b.removeEmpty();var e="";if(c.icon){e+='<img class="empty-icon" src="'+c.icon+'"/>'}if(c.tip){e+='<p class="empty-tip">'+c.tip+"</p>"}if(c.btntext){e+='<p class="empty-btn">'+c.btntext+"</p>"}b.emptyDom=document.createElement("div");b.emptyDom.className="mescroll-empty";b.emptyDom.innerHTML=e;f.appendChild(b.emptyDom);if(c.btnClick){var d=b.emptyDom.getElementsByClassName("empty-btn")[0];d.onclick=function(){c.btnClick()}}}};MeScroll.prototype.removeEmpty=function(){if(this.emptyDom){var a=this.emptyDom.parentNode;if(a){a.removeChild(this.emptyDom)}this.emptyDom=null}};MeScroll.prototype.showTopBtn=function(){if(!this.topBtnShow){this.topBtnShow=true;var a=this;var b=a.optUp.toTop;if(a.toTopBtn==null){a.toTopBtn=document.createElement("img");a.toTopBtn.className=b.warpClass;a.toTopBtn.src=b.src;a.toTopBtn.onclick=function(){a.scrollTo(0,a.optUp.toTop.duration)};document.body.appendChild(a.toTopBtn)}a.toTopBtn.classList.remove(b.hideClass);a.toTopBtn.classList.add(b.showClass)}};MeScroll.prototype.hideTopBtn=function(){if(this.topBtnShow&&this.toTopBtn){this.topBtnShow=false;this.toTopBtn.classList.remove(this.optUp.toTop.showClass);this.toTopBtn.classList.add(this.optUp.toTop.hideClass)}};MeScroll.prototype.scrollTo=function(h,k){if(k==0){this.setScrollTop(h);return}k=k||300;var f=20;var e=k/f;var g=this;var a=g.getScrollHeight()-g.getClientHeight();if(h<0){h=0}if(h>a){h=a}var j=g.getScrollTop()-h;if(j==0){return}var b=j/e;g.isScrollTo=true;var c=0;var d=window.setInterval(function(){if(c<e){if(c==e-1){g.setScrollTop(h)}else{var i=g.getScrollTop()-b;g.setScrollTop(i)}c++}else{g.isScrollTo=false;window.clearInterval(d)}},f)};MeScroll.prototype.getScrollHeight=function(){return this.scrollDom.scrollHeight};MeScroll.prototype.getClientHeight=function(){if(this.isScrollBody&&document.compatMode=="CSS1Compat"){return document.documentElement.clientHeight}else{return this.scrollDom.clientHeight}};MeScroll.prototype.getBodyHeight=function(){return document.body.clientHeight||document.documentElement.clientHeight};MeScroll.prototype.getScrollTop=function(){if(this.isScrollBody){return document.documentElement.scrollTop||document.body.scrollTop}else{return this.scrollDom.scrollTop}};MeScroll.prototype.setScrollTop=function(a){if(this.isScrollBody){document.documentElement.scrollTop=a;document.body.scrollTop=a}else{this.scrollDom.scrollTop=a}};MeScroll.prototype.destroy=function(){var a=this;if(a.optDown.use){a.scrollDom.removeEventListener("touchstart",a.touchstartEvent);a.scrollDom.removeEventListener("mousedown",a.touchstartEvent);a.scrollDom.removeEventListener("touchmove",a.touchmoveEvent);a.scrollDom.removeEventListener("mousemove",a.touchmoveEvent);a.scrollDom.removeEventListener("touchend",a.touchendEvent);a.scrollDom.removeEventListener("mouseup",a.touchendEvent);a.scrollDom.removeEventListener("mouseleave",a.touchendEvent);a.downparent&&a.downparent.removeChild(a.downwarp)}if(a.optUp.use){if(a.isScrollBody){window.removeEventListener("scroll",a.scrollEvent)}else{a.scrollDom.removeEventListener("scroll",a.scrollEvent)}a.upparent&&a.upparent.removeChild(a.upwarp)}a.setBounceDisable(false)};